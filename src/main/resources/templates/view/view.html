<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="/css/layout.css">
    <script src="/js/jquery-3.7.1.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
            crossorigin="anonymous"></script>
</head>
<body>
<div class="productBox">
    <div class="imgBox">
        <div id="carouselExampleAutoplaying" class="carousel slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <th:block th:each="item : ${postList.picturePost}">
                        <div class="carousel-item">
                            <img th:src="@{|/profile/${item}|}" class="d-block w-100" alt="...">
                        </div>
                </th:block>
            </div>
            <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="prev">
                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleAutoplaying" data-bs-slide="next">
                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
    </div>
    <div class="infoBox">
        <div>
            <h2 th:text="${postList.title}"></h2>
        </div>
        <div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item" th:text="${postList.company}"></li>
                <li class="list-group-item" th:text="${postList.material}"></li>
                <li class="list-group-item" ></li>
                <li class="list-group-item">A fourth item</li>
                <li class="list-group-item">And a fifth one</li>
            </ul>
        </div>
    </div>
</div>

<div class="mainpagebox">
    <div th:utext="${postList.content}" class="contentBox"></div>

</div>




<!--리뷰-->
<div>
    <div class="reviewHeader">
        <h2>상품리뷰</h2>
    </div>


    <div class="container">

    </div>

    <div class="reWrite">
        <div class="imginsert">
            <div>
                <input type="file" class="postimg" id="reImg"
                       placeholder="대표이미지" name=""
                       accept="image/gif, image/jpeg, image/png" multiple="multiple">
                <label class="input-file-button" for="reImg">
                    이미지 등록<br><p class="reImgCount">0</p>
                </label>
            </div>
            <div class="col-3 mt-3">
                <select id="star" name=""
                        data-placeholder="별점"
                        class=""
                        aria-label="Small select example" data-style="btn-primary">
                    <option th:value="5.0"><span>★★★★★</span></option>
                    <option th:value="4.0"><span>★★★★☆</span></option>
                    <option th:value="3.0"><span>★★★☆☆</span></option>
                    <option th:value="2.0"><span>★★☆☆☆</span></option>
                    <option th:value="1.0"><span>★☆☆☆☆</span></option>
                </select>
            </div>
        </div>
        <div class="reContent">
            <textarea class="reContent"></textarea>
            <button type="submit" onclick=insertRe()>등록</button>
        </div>
    </div>
</div>

















<script th:inline="javascript">
    const postId= [[${postList.id}]];

    reViewList()
    addClassName()
    function addClassName(){
        let imgbox=$(".carousel-inner > div:first-child");
        imgbox.remove("carousel-item").addClass("carousel-item active");

        let contentBox=$(".contentBox > p > img");
        contentBox.css("object-fit","cover");
    }

    // 리뷰목록조회
    function reViewList(){
        console.log("success")
        $.ajax({
            url:`/review/${postId}`,
            success: function (data){
                let ht="";

                $.each(data,function (key,val){
                    ht+=`<div class="row">
            <div class="col-md-12">
                <div class="reviewBox">
                    <div class="reviewPar">
                        <div class="userinfo">
                            <div style="width: 60px; height: 60px; display: flex">
                                <img src="${val.profile}" style="object-fit: cover; width: 100%; height: 100%;">
                                <div>${val.nickname}</div>
                            </div>
                            <div style="float: right">
                                <span>별점 : </span><span>${val.score}</span>
                                <div>${val.createdDate}</div>
                            </div>
                        </div>
                        <hr>
                        <div class="reviewImglistmg">`;
                        for(let i=0;i<val.pictureReView.length;i++){
                            ht+=`<div style="width: 100px; height: 100px" class="imgBBox">
                                <img src="/profile/${val.pictureReView[i]}" style="object-fit: cover; width: 100%; height: 100%;">
                            </div>`;
                        }
                        ht+=`
                        </div>
                        <hr>
                        <div class="reviewContent" style="padding: 10px">
                            <p>${val.content}</p>
                        </div>
                    </div>
                    <div class="recomment">
                        <div class="recomInfo"><p>대댓글 유저정보</p></div>
                        <div class="recomCon"><p>대댓글 내용</p></div>
                    </div>
                </div>
            </div>
        </div>`;

                })
                $(".container").html(ht);


            },
            error(error){
              console.log("listSelectError")
            }
        })
    }







    <!--리뷰이미지등록-->
    let countRe=0;
    let reImgName=[];
    $(document).ready(function() {
        $('#reImg').change(function() {
            let fileInput = document.getElementById("reImg");
            let file = fileInput.files[0];

            if(fileInput.files.length>3){
                $(".reImgCount").text(0);
                alert("이미지는 3개까지 등록할 수 있습니다");
                fileInput.files=[];
            } else {
                if (file) {
                    let formData = new FormData();
                    for (let i = 0; i < fileInput.files.length; i++) {
                        formData.append('serveImg', fileInput.files[i]);
                    }
                    $.ajax({
                        url: '/post-img/uploadServe',
                        type: 'POST',
                        data: formData,
                        processData: false,
                        contentType: false,
                        success: function (response) {
                            // 파일 업로드가 성공한 경우의 처리
                            for (let i = 0; i < response.length; i++) {
                                reImgName.push(response[i])

                            }
                            countRe=response.length;
                            $(".reImgCount").text(countRe);
                        },
                        error: function (error) {
                            console.log('Error:', error);
                        }
                    });
                } else {
                    alert('파일을 선택하세요.');
                }
            }
        });
    });

    // 리뷰등록
    function insertRe(){
        var reContentValue = document.querySelector(".reContent textarea").value.trim();
        const date={
            "content": reContentValue,
            "score": $("#star").val(),
            "pictureReList":reImgName,
            "post":postId
        }
        console.log(date)
        $.ajax({
            method:"POST",
            url:"/view/reWrite",
            contentType: 'application/json',
            data:JSON.stringify(date),
            success: function (response){
                console.log("리뷰작성 완")
            },
            error:function (){
                console.log("리뷰작성 실패")
            }

        })

    }

</script>

</body>
</html>